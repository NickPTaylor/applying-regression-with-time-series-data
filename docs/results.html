<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Applying Regression with Time Series Data</title>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
  <meta name="description" content="Applying Regression with Time Series Data">
  <meta name="generator" content="bookdown 0.3 and GitBook 2.6.7">

  <meta property="og:title" content="Applying Regression with Time Series Data" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Applying Regression with Time Series Data" />
  
  
  

<meta name="author" content="Nick P Taylor">


<meta name="date" content="2017-04-20">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="method.html">
<link rel="next" href="discussion.html">

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

</head>

<body>


  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Abstract</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="method.html"><a href="method.html"><i class="fa fa-check"></i><b>2</b> Method</a><ul>
<li class="chapter" data-level="2.1" data-path="method.html"><a href="method.html#setup"><i class="fa fa-check"></i><b>2.1</b> Setup</a></li>
<li class="chapter" data-level="2.2" data-path="method.html"><a href="method.html#r-packages"><i class="fa fa-check"></i><b>2.2</b> R Packages</a></li>
<li class="chapter" data-level="2.3" data-path="method.html"><a href="method.html#simulations"><i class="fa fa-check"></i><b>2.3</b> Simulations</a><ul>
<li class="chapter" data-level="2.3.1" data-path="method.html"><a href="method.html#cross-sectional-simulation"><i class="fa fa-check"></i><b>2.3.1</b> Cross-sectional Simulation</a></li>
<li class="chapter" data-level="2.3.2" data-path="method.html"><a href="method.html#time-series-simulation"><i class="fa fa-check"></i><b>2.3.2</b> Time Series Simulation</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="method.html"><a href="method.html#generic-modelling-function"><i class="fa fa-check"></i><b>2.4</b> Generic Modelling Function</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="results.html"><a href="results.html"><i class="fa fa-check"></i><b>3</b> Results</a><ul>
<li class="chapter" data-level="3.1" data-path="results.html"><a href="results.html#linear-regression-modelling"><i class="fa fa-check"></i><b>3.1</b> Linear Regression Modelling</a><ul>
<li class="chapter" data-level="3.1.1" data-path="results.html"><a href="results.html#cross-sectional-sample"><i class="fa fa-check"></i><b>3.1.1</b> Cross-Sectional Sample</a></li>
<li class="chapter" data-level="3.1.2" data-path="results.html"><a href="results.html#time-series-simulation-1"><i class="fa fa-check"></i><b>3.1.2</b> Time Series Simulation</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="results.html"><a href="results.html#arimax-modelling"><i class="fa fa-check"></i><b>3.2</b> ARIMAX Modelling</a><ul>
<li class="chapter" data-level="3.2.1" data-path="results.html"><a href="results.html#fixed-first-order-auto-regressive-error"><i class="fa fa-check"></i><b>3.2.1</b> Fixed First Order Auto-regressive Error</a></li>
<li class="chapter" data-level="3.2.2" data-path="results.html"><a href="results.html#automatically-calculated-auto-regressive-error"><i class="fa fa-check"></i><b>3.2.2</b> Automatically Calculated Auto-regressive Error</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="discussion.html"><a href="discussion.html"><i class="fa fa-check"></i><b>4</b> Discussion</a></li>
<li class="chapter" data-level="5" data-path="conclusion.html"><a href="conclusion.html"><i class="fa fa-check"></i><b>5</b> Conclusion</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Applying Regression with Time Series Data</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="results" class="section level1">
<h1><span class="header-section-number">3</span> Results</h1>
<div id="linear-regression-modelling" class="section level2">
<h2><span class="header-section-number">3.1</span> Linear Regression Modelling</h2>
<div id="cross-sectional-sample" class="section level3">
<h3><span class="header-section-number">3.1.1</span> Cross-Sectional Sample</h3>
<p>A linear regression model is implemented with the <code>lm</code> function from base R. In the next block of code, a function is defined to apply a linear model to each simulation and then the <code>apply_model</code> function, defined in §<a href="method.html#generic-modelling-function">2.4</a>, is invoked to apply the model to each of the simulated observations.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># function for linear model ----------------------------------------------------</span>
lm_mod &lt;-<span class="st"> </span>function(df) {
    <span class="kw">lm</span>(<span class="dt">formula =</span> y ~<span class="st"> </span>x, <span class="dt">data =</span> df)
}

sims_xs_lm_fit &lt;-<span class="st"> </span><span class="kw">apply_model</span>(sims_xs, <span class="dt">model =</span> lm_mod)</code></pre></div>
<p>The next block of code defines and invokes a function to plot the response, <span class="math inline">\(y\)</span>, versus the explanatory variable, <span class="math inline">\(x\)</span>, as a scatter plot and the linear regression model fitted with a black dashed line. The first 5 simulations are shown.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gg_fit_xy_scatter &lt;-<span class="st"> </span>function(df, int_name, term_name, <span class="dt">n =</span> <span class="dv">5</span>, <span class="dt">subtitle =</span> <span class="st">&quot;&quot;</span>) {
    
    <span class="co"># extract first n simulations ----------------------------------------------</span>
    df &lt;-<span class="st"> </span>df %&gt;%<span class="st"> </span>
<span class="st">        </span><span class="kw">slice</span>(<span class="dv">1</span>:n)
    
    df_obs &lt;-<span class="st"> </span>df %&gt;%<span class="st"> </span>
<span class="st">        </span><span class="kw">unnest</span>(obs)
    
    df_coef &lt;-<span class="st"> </span>df %&gt;%<span class="st"> </span>
<span class="st">        </span><span class="kw">unnest</span>(coef) %&gt;%<span class="st"> </span>
<span class="st">        </span><span class="kw">select</span>(id, term, estimate) %&gt;%<span class="st"> </span>
<span class="st">        </span><span class="kw">spread</span>(<span class="dt">key =</span> term, estimate) %&gt;%<span class="st"> </span>
<span class="st">        </span><span class="kw">rename_</span>(<span class="dt">.dots =</span> <span class="kw">setNames</span>(<span class="kw">list</span>(int_name, term_name), <span class="kw">list</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>)))
       
    <span class="co"># y versus x with model fit plot function ----------------------------------</span>
    <span class="kw">ggplot</span>(df_obs, <span class="kw">aes</span>(x, y, <span class="dt">colour =</span> id)) +
<span class="st">        </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="fl">0.3</span>) +
<span class="st">        </span><span class="kw">geom_abline</span>(<span class="dt">data =</span> df_coef, <span class="kw">aes</span>(<span class="dt">slope =</span> b, <span class="dt">intercept =</span> a),
                    <span class="dt">linetype =</span> <span class="st">&#39;dashed&#39;</span>, <span class="dt">colour =</span> <span class="st">&#39;black&#39;</span>) +
<span class="st">        </span><span class="kw">facet_grid</span>(id ~<span class="st"> </span>.) +
<span class="st">        </span><span class="kw">labs</span>(
            <span class="dt">title =</span> <span class="st">&quot;Response versus Explanatory Variable&quot;</span>,
            <span class="dt">subtitle =</span> subtitle,
            <span class="dt">x =</span> <span class="st">&quot;Order&quot;</span>,
            <span class="dt">y =</span> <span class="st">&quot;x&quot;</span>,
            <span class="dt">colour =</span> <span class="st">&#39;Simulation&#39;</span>
        )
}

<span class="kw">gg_fit_xy_scatter</span>(sims_xs_lm_fit, <span class="dt">int_name =</span> <span class="st">&quot;`(Intercept)`&quot;</span>, <span class="dt">term_name =</span> <span class="st">&quot;x&quot;</span>,
                  <span class="dt">subtitle =</span> <span class="st">&quot;Cross-sectional sample with Linear Model Fit&quot;</span>)</code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:gg-xs-fit-lm-xy-scatter"></span>
<img src="applying-regression-with-time-series-data_files/figure-html/gg-xs-fit-lm-xy-scatter-1.png" alt="Scatter plots of the linear model applied to the cross sectional sample." width="70%" />
<p class="caption">
Figure 3.1: Scatter plots of the linear model applied to the cross sectional sample.
</p>
</div>

<p>In the next chunk of code, first, a function is defined which extracts the <em>expected value</em> and <em>confidence intervals</em> for the parameter <span class="math inline">\(x\)</span> in each simulation. A variable, <code>in_bound</code> is defined which classifies each simulation based on whether the confidence interval includes the known population parameter for the <span class="math inline">\(x\)</span> gradient i.e. 1. Next, a function is defined which generates table <a href="results.html#tab:kable-xs-fit-lm-params">3.1</a>, showing the first 5 estimates of the coefficient of <span class="math inline">\(x\)</span> and the corresponding confidence intervals for the linear model applied to the cross-sectional sample.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># get each models expected value and confidence interval and categorise </span>
<span class="co"># each model by whether the confidence interval includes the known population</span>
<span class="co"># coefficient, 1.</span>
get_model_params &lt;-<span class="st"> </span>function(df, term_name) {
    df %&gt;%<span class="st"> </span>
<span class="st">        </span><span class="kw">unnest</span>(coef, conf_int) %&gt;%<span class="st"> </span>
<span class="st">        </span><span class="kw">filter_</span>(~term ==<span class="st"> </span>term_name) %&gt;%<span class="st"> </span>
<span class="st">        </span><span class="kw">mutate</span>(<span class="dt">y =</span> <span class="kw">as.factor</span>(<span class="kw">row_number</span>(id)), 
               <span class="dt">in_bound =</span> <span class="kw">ifelse</span>(conf.low &gt;<span class="st"> </span><span class="dv">1</span> |<span class="st"> </span>conf.high &lt;<span class="st"> </span><span class="dv">1</span>, <span class="ot">FALSE</span>, <span class="ot">TRUE</span>))
}

sims_xs_fit_lm_params &lt;-<span class="st"> </span><span class="kw">get_model_params</span>(sims_xs_lm_fit, <span class="dt">term_name =</span> <span class="st">&quot;x&quot;</span>)

<span class="co"># create table of first n estimates and confidence intervals -------------------</span>
kable_first_n_est_ci &lt;-<span class="st"> </span>function(df, <span class="dt">n =</span> <span class="dv">5</span>, ...) {
    df %&gt;%<span class="st"> </span>
<span class="st">        </span><span class="kw">slice</span>(<span class="dv">1</span>:n) %&gt;%<span class="st"> </span>
<span class="st">        </span><span class="kw">select</span>(<span class="dt">ID =</span> id, <span class="dt">Estimate =</span> estimate, 
               <span class="st">`</span><span class="dt">95% CI Lower Bound</span><span class="st">`</span> =<span class="st"> </span>conf.low,
               <span class="st">`</span><span class="dt">95% CI Upper Bound</span><span class="st">`</span> =<span class="st"> </span>conf.high) %&gt;%<span class="st"> </span>
<span class="st">        </span>knitr::<span class="kw">kable</span>(..., <span class="dt">booktabs =</span> <span class="ot">TRUE</span>)
}

my_caption &lt;-<span class="st"> </span><span class="kw">paste</span>(
    <span class="st">&quot;First five estimates and confidence intervals for the linear model&quot;</span>,
    <span class="st">&quot;applied to the simulated cross-sectional sample described by equation&quot;</span>,
    <span class="st">&quot;</span><span class="ch">\\</span><span class="st"><a href="method.html#eq:lin-mod">(2.1)</a>&quot;</span>)

<span class="kw">kable_first_n_est_ci</span>(sims_xs_fit_lm_params, <span class="dt">caption =</span> my_caption, <span class="dt">digits =</span> <span class="dv">5</span>)</code></pre></div>
<table>
<caption><span id="tab:kable-xs-fit-lm-params">Table 3.1: </span>First five estimates and confidence intervals for the linear model applied to the simulated cross-sectional sample described by equation <a href="method.html#eq:lin-mod">(2.1)</a></caption>
<thead>
<tr class="header">
<th align="left">ID</th>
<th align="right">Estimate</th>
<th align="right">95% CI Lower Bound</th>
<th align="right">95% CI Upper Bound</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">sim_001</td>
<td align="right">0.99827</td>
<td align="right">0.98337</td>
<td align="right">1.01318</td>
</tr>
<tr class="even">
<td align="left">sim_002</td>
<td align="right">0.99709</td>
<td align="right">0.98182</td>
<td align="right">1.01235</td>
</tr>
<tr class="odd">
<td align="left">sim_003</td>
<td align="right">0.98368</td>
<td align="right">0.96836</td>
<td align="right">0.99900</td>
</tr>
<tr class="even">
<td align="left">sim_004</td>
<td align="right">0.99118</td>
<td align="right">0.97573</td>
<td align="right">1.00664</td>
</tr>
<tr class="odd">
<td align="left">sim_005</td>
<td align="right">1.00075</td>
<td align="right">0.98515</td>
<td align="right">1.01635</td>
</tr>
</tbody>
</table>
<p>A <em>useful</em> model predicts the population characteristics given a sample of observations. Indeed, this is demonstrated in figure <a href="results.html#fig:gg-xs-fit-lm-xy-scatter">3.1</a> and table <a href="results.html#tab:kable-xs-fit-lm-params">3.1</a>. In the plots, the lines from the model fit are very similar to <span class="math inline">\(y = x\)</span>. The gradient is not exactly one since the irreducible error, <span class="math inline">\(e\)</span>, is random and this will influence the fit. In table <a href="results.html#tab:kable-xs-fit-lm-params">3.1</a>, the quantities for gradient estimates for the first 5 simulations are given.</p>
<p>The <em>estimate</em> is more completely described as:</p>
<blockquote>
<p><strong>Estimate</strong>. An estimate of the expected value of the coefficient of x i.e. the value of <span class="math inline">\(x\)</span> which is most likely given the sample observed.</p>
</blockquote>
<p>The definition of the <em>95 % confidence interval</em> in the context of the estimated expected value of the coefficient is:</p>
<blockquote>
<p><strong>Confidence Interval</strong>. If samples of the same size are repeatedly taken from a population which adheres to the model, <span class="math inline">\(y = x\)</span>, and a linear model fitted, the 95% confidence interval would contain the actual expected value of the coefficient of <span class="math inline">\(x\)</span>, i.e. 1, 95% of the time.</p>
</blockquote>
<p>The confidence interval (CI) quantifies the probable range of the coefficient of <span class="math inline">\(x\)</span>. For predictive analysis, it is important to compute the CI and to be confident that it is correct. It is observed from the figure and table that the estimates of the first 5 simulations are all close to 1 and that 4 out of 5 confidence intervals include the actual population parameter for the gradient of <span class="math inline">\(x\)</span>. The next block of code offers a visual demonstration of the meaning of the CI.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gg_fit_ci &lt;-<span class="st"> </span>function(df, <span class="dt">n =</span> <span class="dv">40</span>) {
    <span class="co"># extract first n simulations ----------------------------------------------</span>
    df &lt;-<span class="st"> </span>df %&gt;%<span class="st"> </span>
<span class="st">        </span><span class="kw">slice</span>(<span class="dv">1</span>:n)
    
    <span class="co"># plot confidence intervals as lines --------------------------------------- </span>
    <span class="kw">ggplot</span>(df, <span class="kw">aes</span>(estimate, y)) +
<span class="st">        </span><span class="kw">geom_point</span>(
            <span class="kw">aes</span>(<span class="dt">colour =</span> <span class="kw">factor</span>(in_bound, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;TRUE&quot;</span>, <span class="st">&quot;FALSE&quot;</span>)))) +<span class="st"> </span>
<span class="st">        </span><span class="kw">geom_segment</span>(<span class="kw">aes</span>(<span class="dt">x =</span> conf.low, <span class="dt">xend =</span> conf.high, <span class="dt">y =</span> y, <span class="dt">yend =</span> y,
                         <span class="dt">colour =</span> in_bound), <span class="dt">alpha =</span> <span class="fl">0.5</span>) +
<span class="st">        </span><span class="kw">scale_colour_manual</span>(
            <span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;FALSE&quot;</span> =<span class="st"> &#39;red&#39;</span>, <span class="st">&quot;TRUE&quot;</span> =<span class="st"> &#39;black&#39;</span>), <span class="dt">drop =</span> <span class="ot">FALSE</span>) +
<span class="st">        </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="fl">0.95</span>, <span class="fl">1.05</span>)) +
<span class="st">        </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="dv">1</span>, <span class="dt">colour =</span> <span class="st">&#39;blue&#39;</span>, <span class="dt">linetype =</span> <span class="st">&#39;dashed&#39;</span>) +
<span class="st">        </span><span class="kw">labs</span>(
            <span class="dt">title =</span> <span class="st">&quot;Confidence intervals ranges for x coefficients of x&quot;</span>,
            <span class="dt">subtitle =</span> <span class="st">&quot;Red CIs do NOT include the known coefficient of 1&quot;</span>,
            <span class="dt">x =</span> <span class="st">&quot;x&quot;</span>,
            <span class="dt">y =</span> <span class="st">&quot;Simulation No.&quot;</span>,
            <span class="dt">colour =</span> <span class="st">&quot;CI includes 1?&quot;</span>
        )
}

<span class="kw">gg_fit_ci</span>(sims_xs_fit_lm_params)</code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:gg-xs-fit-lm-ci"></span>
<img src="applying-regression-with-time-series-data_files/figure-html/gg-xs-fit-lm-ci-1.png" alt="Line plots of confidence intervals for the linear model applied to the cross sectional sample." width="70%" />
<p class="caption">
Figure 3.2: Line plots of confidence intervals for the linear model applied to the cross sectional sample.
</p>
</div>

<p>By definition, the expectation is that 2 out of 40 simulations will have a 95% CI that does <em>not</em> contain the actual population parameter. Indeed, this is observed, although it would not have been a surprise if this did not quite work out. After all, 40 simulations is a small sample and the analysis is stochastic.</p>
<p>If the entire 10000 simulations are considered, the sample size of the samples is sufficient to verify the performance of the model against the known population parameters. In the following chunk of code, a function is created to report the average of the estimated expected values and the percentage of confidence intervals that contain the population coefficient of x.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># function to report quality of fit --------------------------------------------</span>
sim_report &lt;-<span class="st"> </span>function(df) {
    my_str =<span class="st"> </span><span class="kw">str_wrap</span>(<span class="kw">str_c</span>(
        <span class="st">&quot;For %i simulations, with %i obsersvations in each simulation, the mean&quot;</span>,
        <span class="st">&quot;expected value of the $x$ coefficient is %.3f and %.3f%% of the&quot;</span>,
        <span class="st">&quot;simulations have 95%% CIs that contain the true value of $x$.&quot;</span>,
    <span class="dt">sep =</span> <span class="st">&quot; &quot;</span>), <span class="dt">width =</span> <span class="dv">70</span>)
    
    <span class="kw">sprintf</span>(
      my_str,
      no_sims,
      no_obs,
      <span class="kw">mean</span>(df$estimate),
      <span class="dv">100</span> *<span class="st"> </span><span class="kw">mean</span>(df$in_bound)
    )
}

report_xs_fit_lm &lt;-<span class="st"> </span><span class="kw">sim_report</span>(sims_xs_fit_lm_params)</code></pre></div>
<p>The output of the report is:</p>
<blockquote>
<p>For 10000 simulations, with 500 obsersvations in each simulation, the mean expected value of the <span class="math inline">\(x\)</span> coefficient is 1.000 and 94.980% of the simulations have 95% CIs that contain the true value of <span class="math inline">\(x\)</span>.</p>
</blockquote>
<p>Recalling the definitions given in §<a href="method.html#simulations">2.3</a>, the results indicate that when applying a linear regression to the cross-sectional sample simulations, that the model performance is:</p>
<ul>
<li><p><strong>Unbiased</strong> - the mean of the estimate for the expected value of the <span class="math inline">\(x\)</span> coefficient is extremely close to the actual population parameter.</p></li>
<li><p><strong>Efficient</strong> - the 95% CI includes the actual population parameter almost exactly 95% of the time.</p></li>
</ul>
</div>
<div id="time-series-simulation-1" class="section level3">
<h3><span class="header-section-number">3.1.2</span> Time Series Simulation</h3>
<p>Now, the time series simulations are considered. Recalling the plot for the time series simulations of response versus explanatory variable in figure <a href="method.html#fig:gg-sims-ts-sctr">2.2</a>, at first glance it may seem that applying a linear model would be reasonable. Observation suggests that the variance in <span class="math inline">\(y\)</span> can be mostly explained by the variance in <span class="math inline">\(x\)</span> and that the relationship is linear. In the next code block, similarly to in §<a href="method.html#cross-sectional-simulation">2.3.1</a>, a linear model is applied to the time series simulations.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sims_ts_lm_fit &lt;-<span class="st"> </span><span class="kw">apply_model</span>(sims_ts, lm_mod)</code></pre></div>
<p>Consider the scatter plot of the first 5 simulated observations (points) and the model fit (black line) shown in figure <a href="results.html#fig:gg-ts-fit-lm-xy-scatter">3.3</a>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">gg_fit_xy_scatter</span>(sims_ts_lm_fit, <span class="dt">int_name =</span> <span class="st">&quot;`(Intercept)`&quot;</span>, <span class="dt">term_name =</span> <span class="st">&quot;x&quot;</span>,
                  <span class="dt">subtitle =</span> <span class="st">&quot;Time series sample with Linear Model Fit&quot;</span>)</code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:gg-ts-fit-lm-xy-scatter"></span>
<img src="applying-regression-with-time-series-data_files/figure-html/gg-ts-fit-lm-xy-scatter-1.png" alt="Scatter plots of the linear model applied to the time series sample." width="70%" />
<p class="caption">
Figure 3.3: Scatter plots of the linear model applied to the time series sample.
</p>
</div>

<p>Indeed, at a first glance, the fit looks to be very reasonable. However, consider now the plots of confidence intervals for the expected value of the gradient of <span class="math inline">\(x\)</span>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sims_ts_fit_lm_params &lt;-<span class="st"> </span><span class="kw">get_model_params</span>(sims_ts_lm_fit, <span class="dt">term_name =</span> <span class="st">&quot;x&quot;</span>)
<span class="kw">gg_fit_ci</span>(sims_ts_fit_lm_params)</code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:gg-ts-fit-lm-ci"></span>
<img src="applying-regression-with-time-series-data_files/figure-html/gg-ts-fit-lm-ci-1.png" alt="Line plots of confidence intervals for the linear model applied to the time series sample." width="70%" />
<p class="caption">
Figure 3.4: Line plots of confidence intervals for the linear model applied to the time series sample.
</p>
</div>

<p>Recall that for 40 simulations, if the confidence interval is correct, statistically, only 2 should <em>not</em> include the known population parameter for the gradient i.e. 1. In figure <a href="results.html#fig:gg-ts-fit-lm-ci">3.4</a>, 17 confidence intervals do not include 1! Considering the each of the <code>no_sims</code> simulations using the <code>sim_report</code> function defined previously:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">report_ts_fit_lm &lt;-<span class="st"> </span><span class="kw">sim_report</span>(sims_ts_fit_lm_params)</code></pre></div>
<blockquote>
<p>For 10000 simulations, with 500 obsersvations in each simulation, the mean expected value of the <span class="math inline">\(x\)</span> coefficient is 1.000 and 74.730% of the simulations have 95% CIs that contain the true value of <span class="math inline">\(x\)</span>.</p>
</blockquote>
<p>Hence, the finding is that if a linear regression is applied to a <em>time series</em> sample, that the model performance is:</p>
<ul>
<li><p><strong>Unbiased</strong> - similarly to fitting a linear model to a cross-sectional sample, the mean of the estimate for the expected value of the <span class="math inline">\(x\)</span> coefficient is extremely close to the actual population parameter.</p></li>
<li><p><strong>Inefficient</strong> - contrary to fitting a linear model to a cross-sectional sample, the 95% CI is incorrect and is too conservative.</p></li>
</ul>
<p>The reason for this inefficiency is discussed in <a href="discussion.html#discussion">4</a>. In short, the issue is that by definition, equation <a href="method.html#eq:lin-ar1-mod">(2.2)</a> contains two components:</p>
<ul>
<li><p>A linear relationship</p></li>
<li><p>An auto-regressive relationship</p></li>
</ul>
<p>The linear model does not take into account the latter, hence, there is information which explains the observed response which is absent from the model.</p>
</div>
</div>
<div id="arimax-modelling" class="section level2">
<h2><span class="header-section-number">3.2</span> ARIMAX Modelling</h2>
<div id="fixed-first-order-auto-regressive-error" class="section level3">
<h3><span class="header-section-number">3.2.1</span> Fixed First Order Auto-regressive Error</h3>
<p>An approach to modelling regression with time series is described in <span class="citation">Rob J. Hyndman and Athanasopoulos (<a href="#ref-hyndman_2014mm">2014</a>)</span>, <a href="https://www.otexts.org/fpp/9/1">§9.1</a>. The approach is referred to by various names and in this report, it will be referred to as ARIMAX (Auto-regression Integrated Moving Average with Explanatory Variables).</p>
<p>The details are out of scope of this report but a brief description is useful. The approach involves fitting a linear regression and then fitting the residuals with an ARIMA model. In the simulations being described in this report, the order of the ARIMA model is fixed to be first order auto-regressive. In real cases, the order of the ARIMA model is unknown, so the approach involves some iteration until the residual after applying the ARIMA model is as close to white noise as is practically possible.</p>
<p>The ARIMAX model is implemented in R with the <code>forecast</code> package <span class="citation">(Rob J Hyndman <a href="#ref-hyndman_20170222">2017</a>)</span>. First, the application and performance of the model will be demonstrated for a fixed first order auto-regressive error component:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
arimax_ar1_mod &lt;-<span class="st"> </span>function(df) {
    <span class="kw">Arima</span>(<span class="dt">y =</span> df$y, <span class="dt">order =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="dt">xreg =</span> df$x)
}

sims_ts_arimax_ar1_fit &lt;-<span class="st"> </span><span class="kw">apply_model</span>(sims_ts, arimax_ar1_mod, <span class="st">&#39;forecast&#39;</span>)</code></pre></div>
<p>Figure <a href="results.html#fig:gg-ts-fit-arimax-ar1-xy-scatter">3.5</a> shows a scatter plot of the observations and the model fit for the first 5 simulations.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">gg_fit_xy_scatter</span>(sims_ts_arimax_ar1_fit, 
                  <span class="dt">int_name =</span> <span class="st">&quot;intercept&quot;</span>, <span class="dt">term_name =</span> <span class="st">&quot;`df$x`&quot;</span>,
                  <span class="dt">subtitle =</span> <span class="st">&quot;Time series sample with AR1 ARIMAX fit&quot;</span>)</code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:gg-ts-fit-arimax-ar1-xy-scatter"></span>
<img src="applying-regression-with-time-series-data_files/figure-html/gg-ts-fit-arimax-ar1-xy-scatter-1.png" alt="Scatter plots of the AR1 ARIMAX model applied to the time series sample." width="70%" />
<p class="caption">
Figure 3.5: Scatter plots of the AR1 ARIMAX model applied to the time series sample.
</p>
</div>

<p>By observation, it seems that the fit is quite reasonable. Now, consider the confidence intervals shown in figure <a href="results.html#fig:gg-ts-fit-arimax-ar1-ci">3.6</a>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sims_ts_fit_arimax_ar1_params &lt;-<span class="st"> </span><span class="kw">get_model_params</span>(sims_ts_arimax_ar1_fit,
                                                  <span class="dt">term_name =</span> <span class="st">&quot;df$x&quot;</span>)
<span class="kw">gg_fit_ci</span>(sims_ts_fit_arimax_ar1_params)</code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:gg-ts-fit-arimax-ar1-ci"></span>
<img src="applying-regression-with-time-series-data_files/figure-html/gg-ts-fit-arimax-ar1-ci-1.png" alt="Line plots of confidence intervals for the linear model applied to the time series sample." width="70%" />
<p class="caption">
Figure 3.6: Line plots of confidence intervals for the linear model applied to the time series sample.
</p>
</div>

<p>Recalling that if the CI is correct, that 2 in 40 should not include the value 1. Hence, on this evidence, the ARIMAX model shows a significant improvement compared to CI results shown in figure <a href="results.html#fig:gg-ts-fit-lm-ci">3.4</a> for the simple linear regression model. As before, the performance will be computed based on each of the <code>no_sims</code> simulations:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">report_ts_fit_arimax_ar1 &lt;-<span class="st"> </span><span class="kw">sim_report</span>(sims_ts_fit_arimax_ar1_params)</code></pre></div>
<blockquote>
<p>For 10000 simulations, with 500 obsersvations in each simulation, the mean expected value of the <span class="math inline">\(x\)</span> coefficient is 1.000 and 94.540% of the simulations have 95% CIs that contain the true value of <span class="math inline">\(x\)</span>.</p>
</blockquote>
<p>This demonstrates that the ARIMAX model applied to the time series is:</p>
<ul>
<li><p><strong>Unbiased</strong> - the mean of the estimate for the expected value of the <span class="math inline">\(x\)</span> coefficient is extremely close to the actual population parameter.</p></li>
<li><p><strong>Efficient</strong> - the 95% CI includes the actual population parameter almost exactly 95% of the time.</p></li>
</ul>
</div>
<div id="automatically-calculated-auto-regressive-error" class="section level3">
<h3><span class="header-section-number">3.2.2</span> Automatically Calculated Auto-regressive Error</h3>
<p>In the ARIMAX model described in §<a href="results.html#fixed-first-order-auto-regressive-error">3.2.1</a>, the error was fixed to have an order 1 auto-regressive error. As was discussed, in reality, it is very unlikely that the analysis will know the order of the error. For completeness, the next model uses an algorithm which iteratively seeks the best fit ARIMA error structure.</p>
<p>It should be noted that automatic algorithms should be <em>used with care</em> and in particular, various diagnostic checks should be performed to ensure the models validity. This is out of scope and here, the automatic model will simply be applied and reported.</p>
<p>The model is programmed as follows:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
arimax_auto_mod &lt;-<span class="st"> </span>function(df) {
    <span class="kw">auto.arima</span>(<span class="dt">y =</span> df$y, <span class="dt">xreg =</span> df$x)
}

sims_ts_arimax_auto_fit &lt;-<span class="st"> </span><span class="kw">apply_model</span>(sims_ts, arimax_auto_mod, <span class="st">&#39;forecast&#39;</span>)</code></pre></div>
<p>The performance is calculated as follows:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sims_ts_fit_arimax_auto_params &lt;-<span class="st"> </span><span class="kw">get_model_params</span>(sims_ts_arimax_auto_fit,
                                                  <span class="dt">term_name =</span> <span class="st">&quot;df$x&quot;</span>)
##&gt; Warning in bind_rows_(x, .id): Unequal factor levels: coercing to character
report_ts_fit_arimax_auto &lt;-<span class="st"> </span><span class="kw">sim_report</span>(sims_ts_fit_arimax_auto_params)</code></pre></div>
<p>It is found that the model is not biased but is a little inefficient compared to the model for fixed error structure.</p>
<blockquote>
<p>For 10000 simulations, with 500 obsersvations in each simulation, the mean expected value of the <span class="math inline">\(x\)</span> coefficient is 1.000 and 94.082% of the simulations have 95% CIs that contain the true value of <span class="math inline">\(x\)</span>.</p>
</blockquote>

</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-hyndman_2014mm">
<p>Hyndman, Rob J., and George Athanasopoulos. 2014. <em>Forecasting: Principles and Practice</em>. OTexts. <a href="https://www.otexts.org/fpp" class="uri">https://www.otexts.org/fpp</a>.</p>
</div>
<div id="ref-hyndman_20170222">
<p>Hyndman, Rob J. 2017. <em>forecast: Forecasting Functions for Time Series and Linear Models</em>. <a href="http://github.com/robjhyndman/forecast" class="uri">http://github.com/robjhyndman/forecast</a>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="method.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="discussion.html" class="navigation navigation-next " aria-label="Next page""><i class="fa fa-angle-right"></i></a>

<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    if (location.protocol !== "file:" && /^https?:/.test(script.src))
      script.src  = script.src.replace(/^https?:/, '');
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
